#!/usr/bin/env bash

# Pokémon list
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

API_URL="https://pokeapi.co/api/v2/pokemon"
OUTPUT_DIR="pokemon_data"

mkdir -p "$OUTPUT_DIR"

# Cleanup function to handle unexpected termination
cleanup() {
    echo "Cleaning up background jobs..."
    jobs -p | xargs -r kill
}

# Trap script exit and signals
trap cleanup EXIT INT TERM

# Fetch Pokémon data in parallel
for pokemon in "${POKEMON_LIST[@]}"; do
    (
        echo "Fetching data for $pokemon..."
        curl -s "$API_URL/$pokemon" -o "$OUTPUT_DIR/$pokemon.json" \
            && echo "Saved data to $OUTPUT_DIR/$pokemon.json ✅" \
            || echo "Failed to fetch data for $pokemon ❌"
    ) &
done

# Show running background jobs
jobs

# Wait for all background jobs to finish
wait

echo "All Pokémon data fetched successfully."
